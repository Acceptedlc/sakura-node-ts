{"version":3,"sources":["../src/test/migration/testmigration.ts"],"names":[],"mappings":";AAGA,MAAY,IAAI,WAAM,MAAM,CAAC,CAAA;AAE7B,4BAAwB,2BAA2B,CAAC,CAAA;AAEpD,wBAAsC,kBAAkB,CAAC,CAAA;AACzD,6BAAyB,4BAA4B,CAAC,CAAA;AACtD,uBAAqB,eAAe,CAAC,CAAA;AAKrC,QAAQ,CAAC,gBAAgB,EAAE;IACzB,EAAE,CAAC,yBAAyB,EAAE;QAC5B,MAAM,SAAS,GAAW;;;;;;;;;;CAU7B,CAAC;QAEE,IAAI,SAAS,GAAc,IAAI,qBAAS,EAAE,CAAC;QAC3C,SAAS,CAAC,QAAQ,CAAC,WAAI,CAAC,CAAC;QAEzB,IAAI,UAAU,GAAe,IAAI,uBAAU,EAAE,CAAC;QAC9C,UAAU,CAAC,eAAe,EAAE,CAAC;QAC7B,UAAU,CAAC,IAAI,EAAE,CAAC;QAClB,SAAS,CAAC,IAAI,EAAE,CAAC;QAEjB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gDAAgD,EAAE;QACnD,MAAM,SAAS,GAAW,kDAAkD,CAAC;QAE7E,IAAI,SAAS,GAAc,IAAI,qBAAS,EAAE,CAAC;QAC3C,SAAS,CAAC,SAAS,CAAC,WAAI,EAAE,EAAC,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,eAAO,CAAC,WAAW,EAAE,IAAI,EAAE,eAAO,CAAC,QAAQ,EAAC,CAAC,CAAC;QAC9F,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,2BAA2B,EAAE;QAC9B,MAAM,SAAS,GAAW,gDAAgD,CAAC;QAE3E,IAAI,SAAS,GAAc,IAAI,qBAAS,EAAE,CAAC;QAC3C,SAAS,CAAC,UAAU,CAAC,WAAI,EAAE,OAAO,CAAC,CAAC;QACpC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,6BAA6B,EAAE;QAChC,MAAM,SAAS,GAAW,gEAAgE,CAAC;QAE3F,IAAI,SAAS,GAAc,IAAI,qBAAS,EAAE,CAAC;QAC3C,SAAS,CAAC,YAAY,CAAC,WAAI,EAAE,cAAc,EAAE,eAAe,CAAC,CAAC;QAC9D,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","file":"testmigration.js","sourcesContent":["// Copyright 2016 Frank Lin (lin.xiaoe.f@gmail.com). All rights reserved.\n// Use of this source code is governed a license that can be found in the LICENSE file.\n\nimport * as chai from 'chai';\n\nimport {Migration} from '../../migration/migration';\nimport {TableName, Column} from '../../base/decorator';\nimport {Model, SqlType, SqlFlag} from '../../base/model';\nimport {InitTestDb} from '../../migration/inittestdb';\nimport { User } from '../model/user';\n\n\n\n\ndescribe('Test Migration', () => {\n  it('Test Migration.addModel', () => {\n    const expectSql: string = `CREATE TABLE users (\nuid INTEGER PRIMARY KEY, --主键\nusername VARCHAR(255),\ndisplay_name VARCHAR(255), --真实姓名\nmeta JSON,\ncreated_at TIMESTAMP,\nupdated_at TIMESTAMP\n);\nCOMMENT ON COLUMN users.uid IS '主键';\nCOMMENT ON COLUMN users.display_name IS '真实姓名';\n`;\n\n    let migration: Migration = new Migration();\n    migration.addModel(User);\n\n    let initTestDb: InitTestDb = new InitTestDb();\n    initTestDb.initAllTableSql();\n    initTestDb.save();\n    migration.save();\n\n    chai.expect(migration.preview()).to.equal(expectSql);\n  });\n\n  it('Test Migration.addColumn without default value', () => {\n    const expectSql: string = `ALTER TABLE users ADD COLUMN alias VARCHAR(255);`;\n\n    let migration: Migration = new Migration();\n    migration.addColumn(User, {name: 'alias', type: SqlType.VARCHAR_255, flag: SqlFlag.NULLABLE});\n    chai.expect(migration.preview()).to.equal(expectSql);\n  });\n\n  it('Test Migration.dropColumn', () => {\n    const expectSql: string = `ALTER TABLE users DROP COLUMN IF EXISTS alias;`;\n\n    let migration: Migration = new Migration();\n    migration.dropColumn(User, 'alias');\n    chai.expect(migration.preview()).to.equal(expectSql);\n  });\n\n  it('Test Migration.renameColumn', () => {\n    const expectSql: string = `ALTER TABLE users RENAME COLUMN display_name TO display_name2;`;\n\n    let migration: Migration = new Migration();\n    migration.renameColumn(User, 'display_name', 'display_name2');\n    chai.expect(migration.preview()).to.equal(expectSql);\n  });\n});\n"]}