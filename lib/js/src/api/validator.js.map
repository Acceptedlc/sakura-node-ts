{"version":3,"sources":["../src/api/validator.ts"],"names":[],"mappings":"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","file":"validator.js","sourcesContent":["// Copyright 2016 Frank Lin (lin.xiaoe.f@gmail.com). All rights reserved.\n// Use of this source code is governed a license that can be found in the LICENSE file.\n\nimport {ApiError} from './apierror';\n\n/**\n * Utility to validate input parameters and used by Controller.\n */\nexport class Validator {\n  errors: Array<ApiError> = [];\n\n  /**\n   * Returns true if encounter errors through routine.\n   * @returns {boolean} true if encounter errors through routine.\n   */\n  hasErrors(): boolean {\n    return (this.errors.length > 0);\n  }\n\n  /**\n   * Casts any type to number and record error if result is not a number.\n   * @param param Any type of input value.\n   * @param reason Error reason.\n   * @returns {number} Result, should be number type if success.\n   */\n  toNumber(param: any, reason: string = 'param invalid'): number {\n    let result: any = Number(param);\n    if (isNaN(result)) {\n      this.errors.push(new ApiError(reason, 'Bad Request'));\n    }\n    return result;\n  }\n\n  /**\n   * turn array string into number array\n   * @param {*} param number array as string format like: '[1,2,3]'\n   * @param {string} [reason='param invalid']\n   * @returns {number}\n   * \n   * @memberOf Validator\n   */\n  toNumberArray(param: string, reason: string = 'param invalid'): number[] {\n    if (param && param.indexOf('[') === 0 && param.lastIndexOf(']') === param.length - 1) {\n      let strArr: string [] = param.substring(1, param.length - 1).split(',');\n      let numArr: number [] = [];\n      for (let str of strArr) {\n        let num: number = Number(str);\n        if (str !== '' && !isNaN(num)) {\n          numArr.push(num);\n        } else {\n          this.errors.push(new ApiError(reason, 'Bad Request'));\n          break;\n        }\n      }\n      return numArr;\n    } else {\n      this.errors.push(new ApiError(reason, 'Bad Request'));\n    }\n  }\n\n  /**\n   * Casts any type to string.\n   * @param param Any type of input value.\n   * @param reason Error reason.\n   * @returns {String} Result, should be string type if success.\n   */\n  toStr(param: any, reason: string = 'param invalid'): string {\n    return String(param);\n  }\n\n  /**\n   * Casts any type to date.\n   * @param param Any type of input value.\n   * @param reason Error reason.\n   * @returns {String} Result, should be date type if success.\n   */\n  toDate(param: any, reason: string = 'param invalid'): Date {\n    let result: any = new Date(param);\n    if (!result) {\n      this.errors.push(new ApiError(reason, 'Bad Request'));\n    }\n    return result;\n  }\n\n  /**\n   * Casts any type to unix timestamp.\n   * @param param Any type of input value.\n   * @param reason Error reason.\n   * @returns {String} Result, should be number(int) if success.\n   */\n  toUnixTimestamp(param: any, reason: string = 'param invalid'): number {\n    let result: any = new Date(param);\n    if (!result || isNaN(result)) {\n      this.errors.push(new ApiError(reason, 'Bad Request'));\n    }\n    result = Math.floor(result.getTime() / 1000);\n    return result;\n  }\n\n  /**\n   * Casts any type to boolean.\n   */\n  toBoolean(param: any, reason: string = 'param invalid'): Boolean {\n    if (param === typeof Boolean) {\n      return Boolean(param);\n    } else {\n      this.errors.push(new ApiError(reason, 'Bad Request'));\n      return param;\n    }\n  }\n\n  /**\n   * Asserts condition is true, otherwise it will records the error.\n   * @param cond Condition.\n   * @param reason Error reason.\n   */\n  assert(cond: boolean, reason: string): void {\n    if (!cond) {\n      this.errors.push(new ApiError(reason, 'Bad Request'));\n    }\n  }\n}\n"]}